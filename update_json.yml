name: Generate Signed JSON Daily

on:
  schedule:
    - cron: "0 0 * * *"      # ë§¤ì¼ ìì • (UTC ê¸°ì¤€ = í•œêµ­ ì˜¤ì „ 9ì‹œ)
  workflow_dispatch:          # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Recreate private_key.pem from secret
      run: |
        echo "${{ secrets.PRIVATE_KEY_PEM }}" > private_key.pem

    - name: Install dependencies
      run: pip install cryptography

    - name: Run generate_json.py
      run: python generate_json.py

    - name: Commit and push changes
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git add slots_signed.json
        git commit -m "ğŸ” Auto-update signed JSON ($(date -u))" || echo "No changes to commit"
        git push
